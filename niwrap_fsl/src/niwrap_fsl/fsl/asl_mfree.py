# This file was auto generated by Styx.
# Do not edit this file directly.

import typing
import pathlib
from styxdefs import *

ASL_MFREE_METADATA = Metadata(
    id="8fbd783325fe7917654c5469d05f454f6c121254.boutiques",
    name="asl_mfree",
    package="fsl",
    container_image_tag="brainlife/fsl:6.0.4-patched2",
)


AslMfreeParameters = typing.TypedDict('AslMfreeParameters', {
    "@type": typing.NotRequired[typing.Literal["fsl/asl_mfree"]],
    "datafile": InputPathType,
    "mask": InputPathType,
    "out": str,
    "aif": InputPathType,
    "dt": float,
    "metric": typing.NotRequired[InputPathType | None],
    "mthresh": typing.NotRequired[float | None],
    "tcorrect": bool,
    "bata": typing.NotRequired[InputPathType | None],
    "batt": typing.NotRequired[InputPathType | None],
    "bat": bool,
    "bat_grad_thr": typing.NotRequired[float | None],
    "t1": typing.NotRequired[float | None],
    "fa": typing.NotRequired[float | None],
    "std": bool,
    "nwb": typing.NotRequired[float | None],
    "turbo_quasar": bool,
    "shift_factor": typing.NotRequired[float | None],
    "verbose": bool,
})
AslMfreeParametersTagged = typing.TypedDict('AslMfreeParametersTagged', {
    "@type": typing.Literal["fsl/asl_mfree"],
    "datafile": InputPathType,
    "mask": InputPathType,
    "out": str,
    "aif": InputPathType,
    "dt": float,
    "metric": typing.NotRequired[InputPathType | None],
    "mthresh": typing.NotRequired[float | None],
    "tcorrect": bool,
    "bata": typing.NotRequired[InputPathType | None],
    "batt": typing.NotRequired[InputPathType | None],
    "bat": bool,
    "bat_grad_thr": typing.NotRequired[float | None],
    "t1": typing.NotRequired[float | None],
    "fa": typing.NotRequired[float | None],
    "std": bool,
    "nwb": typing.NotRequired[float | None],
    "turbo_quasar": bool,
    "shift_factor": typing.NotRequired[float | None],
    "verbose": bool,
})


class AslMfreeOutputs(typing.NamedTuple):
    """
    Output object returned when calling `AslMfreeParameters(...)`.
    """
    root: OutputPathType
    """Output root folder. This is the root folder for all outputs."""
    result_file: OutputPathType
    """Output results from ASL model-free analysis"""
    bat_img: OutputPathType
    """Estimated tissue BAT image file"""


def asl_mfree_params(
    datafile: InputPathType,
    mask: InputPathType,
    out: str,
    aif: InputPathType,
    dt: float,
    metric: InputPathType | None = None,
    mthresh: float | None = None,
    tcorrect: bool = False,
    bata: InputPathType | None = None,
    batt: InputPathType | None = None,
    bat: bool = False,
    bat_grad_thr: float | None = None,
    t1: float | None = None,
    fa: float | None = None,
    std: bool = False,
    nwb: float | None = None,
    turbo_quasar: bool = False,
    shift_factor: float | None = None,
    verbose: bool = False,
) -> AslMfreeParametersTagged:
    """
    Build parameters.
    
    Args:
        datafile: ASL data file.
        mask: Mask file.
        out: Output directory name.
        aif: Arterial input functions for deconvolution (4D volume, one aif for\
            each voxel within mask).
        dt: Temporal spacing in data (s).
        metric: Metric image file (optional).
        mthresh: Metric threshold (optional).
        tcorrect: Apply correction for timing difference between AIF and tissue\
            curve (optional).
        bata: Arterial BAT image (optional).
        batt: Tissue BAT image (optional).
        bat: Estimate tissue BAT from data and save this image (optional).
        bat_grad_thr: Edge detection gradient threshold (default: 0.2,\
            optional).
        t1: T1 (of blood) value (optional).
        fa: Flip angle (if using LL readout, optional).
        std: Calculate standard deviations on perfusion values using wild\
            bootstrapping (optional).
        nwb: Number of permutations for wild bootstrapping (optional).
        turbo_quasar: Specify this is a Turbo QUASAR Sequence (optional).
        shift_factor: Slice shifting factor in Turbo QUASAR (default value: 1,\
            optional).
        verbose: Enable verbose mode.
    Returns:
        Parameter dictionary
    """
    params = {
        "@type": "fsl/asl_mfree",
        "datafile": datafile,
        "mask": mask,
        "out": out,
        "aif": aif,
        "dt": dt,
        "tcorrect": tcorrect,
        "bat": bat,
        "std": std,
        "turbo_quasar": turbo_quasar,
        "verbose": verbose,
    }
    if metric is not None:
        params["metric"] = metric
    if mthresh is not None:
        params["mthresh"] = mthresh
    if bata is not None:
        params["bata"] = bata
    if batt is not None:
        params["batt"] = batt
    if bat_grad_thr is not None:
        params["bat_grad_thr"] = bat_grad_thr
    if t1 is not None:
        params["t1"] = t1
    if fa is not None:
        params["fa"] = fa
    if nwb is not None:
        params["nwb"] = nwb
    if shift_factor is not None:
        params["shift_factor"] = shift_factor
    return params


def asl_mfree_cargs(
    params: AslMfreeParameters,
    execution: Execution,
) -> list[str]:
    """
    Build command-line arguments from parameters.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Command-line arguments.
    """
    cargs = []
    cargs.append("asl_mfree")
    cargs.extend([
        "--data",
        execution.input_file(params.get("datafile", None))
    ])
    cargs.extend([
        "--mask",
        execution.input_file(params.get("mask", None))
    ])
    cargs.extend([
        "--out",
        params.get("out", None)
    ])
    cargs.extend([
        "--aif",
        execution.input_file(params.get("aif", None))
    ])
    cargs.extend([
        "--dt",
        str(params.get("dt", None))
    ])
    if params.get("metric", None) is not None:
        cargs.extend([
            "--metric",
            execution.input_file(params.get("metric", None))
        ])
    if params.get("mthresh", None) is not None:
        cargs.extend([
            "--mthresh",
            str(params.get("mthresh", None))
        ])
    if params.get("tcorrect", False):
        cargs.append("--tcorrect")
    if params.get("bata", None) is not None:
        cargs.extend([
            "--bata",
            execution.input_file(params.get("bata", None))
        ])
    if params.get("batt", None) is not None:
        cargs.extend([
            "--batt",
            execution.input_file(params.get("batt", None))
        ])
    if params.get("bat", False):
        cargs.append("--bat")
    if params.get("bat_grad_thr", None) is not None:
        cargs.extend([
            "--bat_grad_thr",
            str(params.get("bat_grad_thr", None))
        ])
    if params.get("t1", None) is not None:
        cargs.extend([
            "--t1",
            str(params.get("t1", None))
        ])
    if params.get("fa", None) is not None:
        cargs.extend([
            "--fa",
            str(params.get("fa", None))
        ])
    if params.get("std", False):
        cargs.append("--std")
    if params.get("nwb", None) is not None:
        cargs.extend([
            "--nwb",
            str(params.get("nwb", None))
        ])
    if params.get("turbo_quasar", False):
        cargs.append("--turbo_quasar")
    if params.get("shift_factor", None) is not None:
        cargs.extend([
            "--shift_factor",
            str(params.get("shift_factor", None))
        ])
    if params.get("verbose", False):
        cargs.append("--verbose")
    return cargs


def asl_mfree_outputs(
    params: AslMfreeParameters,
    execution: Execution,
) -> AslMfreeOutputs:
    """
    Build outputs object containing output file paths and possibly stdout/stderr.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Outputs object.
    """
    ret = AslMfreeOutputs(
        root=execution.output_file("."),
        result_file=execution.output_file(params.get("out", None) + "/results.nii.gz"),
        bat_img=execution.output_file(params.get("out", None) + "/bat.nii.gz"),
    )
    return ret


def asl_mfree_execute(
    params: AslMfreeParameters,
    runner: Runner | None = None,
) -> AslMfreeOutputs:
    """
    asl_mfree
    
    ASL model-free analysis tool.
    
    Author: FMRIB Analysis Group, University of Oxford
    
    URL: https://fsl.fmrib.ox.ac.uk/fsl/fslwiki
    
    Args:
        params: The parameters.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `AslMfreeOutputs`).
    """
    runner = runner or get_global_runner()
    execution = runner.start_execution(ASL_MFREE_METADATA)
    params = execution.params(params)
    cargs = asl_mfree_cargs(params, execution)
    ret = asl_mfree_outputs(params, execution)
    execution.run(cargs)
    return ret


def asl_mfree(
    datafile: InputPathType,
    mask: InputPathType,
    out: str,
    aif: InputPathType,
    dt: float,
    metric: InputPathType | None = None,
    mthresh: float | None = None,
    tcorrect: bool = False,
    bata: InputPathType | None = None,
    batt: InputPathType | None = None,
    bat: bool = False,
    bat_grad_thr: float | None = None,
    t1: float | None = None,
    fa: float | None = None,
    std: bool = False,
    nwb: float | None = None,
    turbo_quasar: bool = False,
    shift_factor: float | None = None,
    verbose: bool = False,
    runner: Runner | None = None,
) -> AslMfreeOutputs:
    """
    asl_mfree
    
    ASL model-free analysis tool.
    
    Author: FMRIB Analysis Group, University of Oxford
    
    URL: https://fsl.fmrib.ox.ac.uk/fsl/fslwiki
    
    Args:
        datafile: ASL data file.
        mask: Mask file.
        out: Output directory name.
        aif: Arterial input functions for deconvolution (4D volume, one aif for\
            each voxel within mask).
        dt: Temporal spacing in data (s).
        metric: Metric image file (optional).
        mthresh: Metric threshold (optional).
        tcorrect: Apply correction for timing difference between AIF and tissue\
            curve (optional).
        bata: Arterial BAT image (optional).
        batt: Tissue BAT image (optional).
        bat: Estimate tissue BAT from data and save this image (optional).
        bat_grad_thr: Edge detection gradient threshold (default: 0.2,\
            optional).
        t1: T1 (of blood) value (optional).
        fa: Flip angle (if using LL readout, optional).
        std: Calculate standard deviations on perfusion values using wild\
            bootstrapping (optional).
        nwb: Number of permutations for wild bootstrapping (optional).
        turbo_quasar: Specify this is a Turbo QUASAR Sequence (optional).
        shift_factor: Slice shifting factor in Turbo QUASAR (default value: 1,\
            optional).
        verbose: Enable verbose mode.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `AslMfreeOutputs`).
    """
    params = asl_mfree_params(
        datafile=datafile,
        mask=mask,
        out=out,
        aif=aif,
        dt=dt,
        metric=metric,
        mthresh=mthresh,
        tcorrect=tcorrect,
        bata=bata,
        batt=batt,
        bat=bat,
        bat_grad_thr=bat_grad_thr,
        t1=t1,
        fa=fa,
        std=std,
        nwb=nwb,
        turbo_quasar=turbo_quasar,
        shift_factor=shift_factor,
        verbose=verbose,
    )
    return asl_mfree_execute(params, runner)


__all__ = [
    "ASL_MFREE_METADATA",
    "AslMfreeOutputs",
    "asl_mfree",
    "asl_mfree_execute",
    "asl_mfree_params",
]
